{% extends 'base.html' %}
{% block title %}
Корзина
{% endblock title %}
{% block header_down %}
<div class='header-title'>
    Корзина
</div>
{% endblock %}
{% block content %}
<link href="{{ url_for('static', filename='css/style.css') }}" rel='stylesheet' type='text/css' />

<style>
    .inner_content {
        margin-top: 20px;
    }
    .container {
        max-width: 100%;
        padding-right: 15px;
        padding-left: 15px;
        margin-right: auto;
        margin-left: auto;
    }
    .table {
        width: 100%;
        margin-bottom: 1rem;
        color: #212529;
        border-collapse: collapse;
    }
    .table th, .table td {
        padding: 0.75rem;
        vertical-align: top;
        border-top: 1px solid #dee2e6;
    }
    .table thead th {
        vertical-align: bottom;
        border-bottom: 2px solid #dee2e6;
    }
    .table tbody + tbody {
        border-top: 2px solid #dee2e6;
    }
    .table-responsive {
        display: block;
        width: 100%;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }
    .tittle {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 20px;
    }
</style>

<div class="inner_content">
    <div class="container">
        <div class="tittle_head">
            <h3 class="tittle">
                <span>Ваша корзина</span>
            </h3>
        </div>
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Блюдо</th>
                        <th>Количество</th>
                        <th>Цена (₽)</th>
                        <th>Сумма (₽)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in cart_items %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ item.get('name') }}</td>
                        <td>{{ item.get('count') }}</td>
                        <td>{{ "%.2f"|format(item.summ) }}</td>
                        <td>{{ "%.2f"|format(item.get('summ', 0) * item.get('count', 1)) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const compare = (idx, asc) => (a, b) => {
            return (
                (v1, v2) =>
                    v1 !== '' && v2 !== '' && !isNaN(v1) && !isNaN(v2)
                        ? v1 - v2
                        : v1.toString().localeCompare(v2)
            )(getCellValue(asc ? a : b, idx), getCellValue(asc ? b : a, idx));
        };

        const getCellValue = (row, index) => row.children[index].textContent.trim();

        document.querySelectorAll('th').forEach(th =>
            th.addEventListener('click', (() => {
                const table = th.closest('table');
                const tbody = table.querySelector('tbody');
                Array.from(tbody.querySelectorAll('tr'))
                    .sort(compare(Array.from(th.parentNode.children).indexOf(th), this.asc = !this.asc))
                    .forEach(row => tbody.appendChild(row));
            }))
        );
    });
</script>
{% endblock content %}
